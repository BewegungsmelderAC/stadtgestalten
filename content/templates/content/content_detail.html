{% extends 'stadt/stadt.html' %}
{% load cache content rules %}

{% block heading %}{% endblock %}

{% block meta %}
    {% if content.event %}
        {% include "meta/event.html" %}
    {% else %}
        {% include "meta/article.html" %}
    {% endif %}
{% endblock %}

{% block content %}
    {% cache cache_timeout content-detail user.gestalt.id content.id %}
    <article class="content">
        {% include 'content/_content_header.html' %}

        <div class="content-body" data-component="user-content">
            <h1 class="content-title">
                {{ content.title }}
            </h1>

            {% if content.event %}
                {% include "macros/event_meta.html" with event=content.event %}
            {% endif %}

            {% if content.gallery %}
                {% include 'content/_content_gallery.html' %}
            {% else %}
                {% markdown content.text heading_baselevel=2 %}
            {% endif %}

            {% include 'content/_content_license.html' %}
        </div>

        <div class="clearfix"></div>

        <footer class="content-footer">
            {% include 'content/_content_comments.html' %}
        </footer>
    </article>
    {% endcache %}
{% endblock %}


{% block sidebar %}
    {% if group %}
        {% include 'entities/_sidebar_group.html' with group=group %}
    {% else %}
        {% has_perm 'content.view_author' user content as can_view_author %}
        {% has_perm 'entities.view_gestalt' user content.author as can_view_gestalt %}
        {% if can_view_gestalt and can_view_author %}
            {% include 'entities/_sidebar_author.html' with gestalt=content.author %}
        {% endif %}
    {% endif %}
{% endblock %}
