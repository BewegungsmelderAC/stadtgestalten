{% extends 'content.html' %}
{% load content rules %}


{% block leftcontent %}
{% if group %}
{% url 'group' group.slug as back_url %}
{% else %}
{% url 'gestalt' content.author.user.username as back_url %}
{% endif %}
<a href="{{ back_url }}" class="btn btn-primary">&lt;&lt;</a>
{% endblock %}


{% block maincontent %}
{% has_perm 'content.change_content' user content as can_edit_content %}

{% if group %}
{% url 'content-update' content.pk group.slug as content_update_url %}
{% else %}
{% url 'content-update' content.pk as content_update_url %}
{% endif %}

<article>
    <header>
        <h1>
            {% if content.event %}
            {{ content.event.time|date:'l, j.n.Y:' }}
            {% endif %}
            {{ content.title }}
            {% if can_edit_content %}
            <a href="{{ content_update_url }}"><i class="fa fa-pencil" title="Beitrag bearbeiten"></i></a>
            {% endif %}
        </h1>
        <p>{{ content.date_created|date:'d.m.Y' }} | <a href="{% url 'gestalt' content.author.user.username %}">{{ content.author }}</a> &nbsp; {{ content.comment_set.count }} &nbsp; {{ content.attention_set.count }}</p>
    </header>

    {% if content.event %}
    <p><strong>Ort:</strong> {{ content.event.place }}</p>
    <p><strong>Zeit:</strong> {{ content.event.time|date:'G:i' }}</p>
    {% endif %}
    <p>
    {% with image=content.image_set.first %}
    {% if image %}
    <img src="{{ image.image.url }}" class="pull-left">
    {% endif %}
    {% endwith %}
    {{ content.text|markdown }}
    </p>
</article>
{% endblock %}


{% block footcontent %}
<h2>Kommentare zum Beitrag</h2>

{% for comment in content.comment_set.all %}
<a href="{% url 'gestalt' comment.author.user.username %}"><img src="{{ comment.author.avatar.url }}" title="{{ comment.author }}" alt="{{ comment.author }}" class="pull-left"></a>
<p>{{ comment.date_created|date:'d.m.Y' }} | {{ comment.text }}</p>
<hr style="clear:both">
{% endfor %}

<form class="form-inline">
    <a href="{% url 'gestalt' content.author.user.username %}"><img src="{{ content.author.avatar.url }}" title="{{ content.author }}" alt="{{ content.author }}" class="pull-left"></a>
    <textarea class="form-control" rows="2"></textarea>
    <button class="btn btn-default">&gt;</button>
</form>
{% endblock %}
