{% load cache rules thumbnail utils crispy_forms_tags  %}

{% has_perm 'content.group_create' user group as can_create_content %}
{% has_perm 'entities.create_group_message' user group as can_create_message %}

<div class="group-header">
    <div class="group-gallery">
        {% with images=group.get_head_gallery.container.gallery_images.all %}
            {% if images %}
                <div class="carousel-container" data-component="carousel">
                    <div class="carousel">
                        <ol class="carousel-slides">
                            {% for image in images %}
                                <li>
                                    {% thumbnail image.image.file 'x500' crop='center' as thumb %}
                                        <img src="{{ thumb.url }}" alt="{{ group.name }}">
                                    {% endthumbnail %}
                                </li>
                            {% endfor %}
                        </ol>
                    </div>
                </div>
            {% else %}
                <div class="disclaimer">
                    <i class="fa fa-5x fa-image"></i><br />
                    Diese Gruppe war zu faul eine Introgalerie anzulegen.
                </div>
            {% endif %}
        {% endwith %}

        {% if can_create_content %}
            <div class="btn-toolbar btn-toolbar-bottom btn-toolbar-fixed">
                {% if group.get_head_gallery %}
                    <a class="btn btn-backdrop btn-ts" href="{{ group.get_head_gallery.get_absolute_url }}" title="Introgalerie anzeigen">
                        <i class="fa fa-2x fa-camera"></i>
                    </a>
                {% else %}
                <a class="btn btn-backdrop btn-ts" href="{% url 'create-group-gallery' group.slug %}?pinned=1&amp;public=1&amp;text=Introgalerie%20der%20Gruppe%20%40{{ group.slug|urlencode }}&amp;title={{ group|urlencode }}" title="Introgalerie anlegen">
                        <i class="fa fa-2x fa-camera"></i>
                    </a>
                {% endif %}
            </div>
        {% endif %}
    </div>
    <div class="group-info">
        <div class="group-info-main">
            <a href="{% url 'group-avatar-update' group.pk %}" class="avatar-edit-inline">
                {% include 'groups/_avatar.html' with group=group link=False %}
            </a>
            <h1 class="group-title">
                {{ group.name }}
            </h1>
            <dl class="def def-icons">
                <dt>
                    <i class="sg sg-question"></i>
                    <span class="sr-only">Kurzbeschreibung</span>
                </dt>
                <dd>{{ group.description|default:"Die Gruppe war zu beschäftigt eine Kurzbeschreibung zu hinterlegen" }}</dd>
                {% if group.address %}
                    <dt>
                        <i class="sg sg-address" title="Anschrift"></i>
                        <span class="sr-only">Anschrift</span>
                    </dt>
                    <dd>
                        <address>
                            {{ group.address|linebreaks }}
                        </address>
                    </dd>
                {% endif %}
                {% if group.url %}
                    <dt>
                        <i class="sg sg-url" title="Website"></i>
                        <span class="sr-only">Website</span>
                    </dt>
                    <dd>
                        <a href="{{ group.url }}">{{ group.url|cut:'http://'|cut:'https://'|cuttrailing:'/' }}</a>
                    </dd>
                {% endif %}
                <dt>
                    <i class="sg sg-foundation"></i>
                    <span class="sr-only">Gründung</span>
                </dt>
                <dd>
                    {{ group.date_founded|date:'Y' }} gegründet
                </dd>
                {% include_fragments 'group-meta' %}
            </dl>
        </div>
        <div class="group-info-slug">
            <dl class="def def-icons">
                <dt>
                    <i class="sg sg-link"></i>
                    <span class="sr-only">URL auf Stadtgestalten</span>
                </dt>
                <dd class="selectable">
                    {{ site.domain }}/<span class="selectable-token">{{ group.slug }}</span>
                    <button type="button" class="btn-text hide-no-js" data-component="clipboard"
                            data-clipboard-text="{{ site.domain }}/{{ group.slug }}"
                            title="URL zu dieser Gruppe kopieren">
                        <i class="sg sg-copy"></i>
                    </button>
                </dd>
            </dl>
        </div>
    </div>
</div>

<div class="content-toolbar">
    <div class="carousel-actions"></div>
    {% include 'groups/detail/_actions.html' with group=group %}
</div>
