{% load rules %}
<nav class="nav">
    <div class="container">
        <a class="nav-logo" href="{% url 'index' %}">{{ site.name }}</a>
        <ul class="nav-menu nav-menu-self">

            {# about link #}
            <li><a href="{% url 'group' about_group.slug %}">Über {{ site.name }}</a></li>
            {% if user.is_authenticated and user.gestalt.groups.exists %}

            {# groups menu #}
            <li>
                <input class="dropdown-state" id="menu-groups" type="checkbox"/>
                <label for="menu-groups" class="nav-state-toggle">
                    {{ group|default:'Meine Gruppen' }} <span class="caret"></span>
                </label>
                <ul class="nav-menu dropdown">
                    {% if group %}
                    {% has_perm 'entities.create_group_attention' user group as can_pay_attention %}
                    <li><a href="{{ group.get_absolute_url }}">{{ group }}</a></li>
                    {% if can_pay_attention %}
                    <li><a href="{% url 'group-attention-create' group.pk %}"><i class="sg sg-attention"></i> Benachrichtigungen abonnieren</a></li>
                    {% endif %}
                    <li><a href="{% url 'message-create' group.pk %}"><i class="sg sg-message"></i> Nachricht schreiben</a></li>
                    <li role="separator" class="dropdown-separator"></li>
                    <li class="dropdown-header">Meine Gruppen</li>
                    {% endif %}
                    {% for group in user.gestalt.groups.all %}
                    <li><a href="{{ group.get_absolute_url }}">{{ group }}</a></li>
                    {% endfor %}
                </ul>
            </li>
            {% elif group %}
            <li><a href="{% url 'group' group.slug %}">{{ group }}</a></li>
            {% endif %}

            {# user menu #}
            {% if user.is_authenticated %}
                <li>
                    <input class="dropdown-state" id="menu-user" type="checkbox"/>
                    <label for="menu-user" class="nav-state-toggle">
                        {{ user.gestalt }} <span class="caret"></span>
                    </label>
                    <ul class="nav-menu dropdown">
                        <li><a href="{% url 'gestalt' user.username %}">Meine Seite</a></li>
                        <li><a href="{% url 'gestalt-update' user.gestalt.pk %}">Profil ändern</a></li>
                        <li><a href="{% url 'account_change_password' %}">Kennwort ändern</a></li>
                        <li><a href="{% url 'account_logout' %}?next={{ request.path }}">Abmelden</a></li>
                    </ul>
                </li>
            {% else %}
                <li><a href="{% url 'account_login' %}?next={{ request.path }}">Anmelden</a></li>
            {% endif %}

        </ul>
        <div class="clearfix"></div>
        <ul class="nav-menu nav-menu-primary">
            <li>
                <a href="{% url 'group-index' %}" class="{% if menu|lower == 'group' %}nav-menu-item-current{% endif %}">Gruppen</a>
            </li>
            <li>
                <a href="{% url 'gestalt-index' %}" class="{% if menu|lower == 'gestalt' %}nav-menu-item-current{% endif %}">Gestalten</a>
            </li>
            <li class="nav-separator" role="presentation"></li>
            <li>
                <a href="{% url 'article-index' %}" class="{% if menu|lower == 'article' %}nav-menu-item-current{% endif %}">Artikel</a>
            </li>
            <li>
                <a href="{% url 'event-index' %}" class="{% if menu|lower == 'event' %}nav-menu-item-current{% endif %}">Ereignisse</a>
            </li>
            <li>
                <a href="{% url 'gallery-index' %}" class="{% if menu|lower == 'gallery' %}nav-menu-item-current{% endif %}">Galerien</a>
            </li>
        </ul>
    </div>
</nav>
