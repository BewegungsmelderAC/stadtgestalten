{% load entities rules thumbnail %}

{% has_perm 'content.view_content' user head_gallery as can_view_head_gallery %}
{% has_perm 'entities.change_group' user group as can_edit %}
{% has_perm 'entities.create_group_attention' user group as can_create_attention %}
{% has_perm 'entities.create_group_content' user group as can_create_content %}
{% has_perm 'entities.create_group_message' user group as can_create_message %}
{% has_perm 'entities.create_membership' user group as can_create_membership %}
{% has_perm 'entities.delete_group_attention' user attention as can_delete_attention %}
{% has_perm 'entities.delete_membership' user membership as can_delete_membership %}
{% has_perm 'entities.list_members' user group as can_list_members %}

<div class="group-header" data-component="group-header">
    <div class="group-gallery">
        {% if head_gallery and can_view_head_gallery %}
            <div class="carousel">
                <div class="carousel-slides">
                    {% for image in head_gallery.images.all %}
                        <li>
                            {% thumbnail image.file 'x500' crop='center' as thumb %}
                                <img src="{{ thumb.url }}" alt="{{ group.name }}">
                            {% endthumbnail %}
                        </li>
                    {% endfor %}
                </div>
            </div>
        {% else %}
            <div class="disclaimer">
                <i class="fa fa-5x fa-image"></i><br />
                Diese Gruppe war zu faul eine Introgalerie anzulegen.

                {% if can_create_content %}
                    <div class="btn-toolbar btn-toolbar-bottom btn-toolbar-fixed">
                        <a class="btn btn-transparent" href="{% url 'gallery-create' %}?group={{ group.slug }}&pinned=1&public=1" title="Intro-Galerie hinzufügen">
                            <i class="fa fa-2x fa-camera"></i>
                        </a>
                    </div>
                {% endif %}
            </div>
        {% endif %}
    </div>
    <div class="group-info">
        <div class="group-info-main">
            <div class="group-avatar">
                {% group_avatar group %}
                <div class="btn btn-toolbar-fixed btn-toolbar-bottom">
                    {% if can_edit %}
                        <a href="{% url 'group-avatar-update' group.pk %}" title="Avatar ändern" class="btn btn-transparent">
                            <i class="sg sg-edit"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
            <h1 class="group-title">
                {{ group.name }}
            </h1>
            <dl class="def def-icons">
                <dt>
                    <i class="sg sg-address"></i>
                    <span class="sr-only">Address</span>
                </dt>
                <dd>
                    <address>
                        {{ group.address|linebreaks }}
                    </address>
                </dd>
                <dt>
                    <i class="sg sg-url"></i>
                    <span class="sr-only">Website</span>
                </dt>
                <dd>
                    <a href="{{ group.url }}">{{ group.url|cut:'http://' }}</a>
                </dd>
                <dt>
                    <i class="sg sg-foundation"></i>
                    <span class="sr-only">Gründung</span>
                </dt>
                <dd>
                    {{ group.date_founded|date:'Y' }} gegründet
                </dd>
                <dt>
                    <i class="sg sg-members"></i>
                    <span class="sr-only">Anzahl Mitglieder</span>
                </dt>
                <dd>
                    {% if can_list_members %}
                        <a href="{% url 'membership-list' group.pk %}">
                    {% endif %}
                    {{ group.membership_set.count }} Mitglied{{ group.membership_set.count|pluralize:"er" }}{% if can_list_members %}</a>{% endif %}

                    {% if user.gestalt in group.members.all %}
                        (Du bist Mitglied)
                    {% endif %}
                </dd>
            </dl>

            {% if can_create_message %}
                <i class="sg sg-message"></i> <a href="{% url 'message-create' group.pk %}">Nachricht schreiben</a>
            {% endif %}



            {% if can_create_membership %}
                <a href="{% url 'membership-create' group.pk %}" class="btn btn-default btn-sm"><i class="sg sg-join"></i> Mitglied werden</a>
            {% endif %}

            {% if can_delete_membership %}
                <a href="{% url 'membership-delete' membership.pk %}"><i class="sg sg-resign" title="Mitgliedschaft beenden"></i></a>
            {% endif %}


            {% if can_create_attention %}
                <a href="{% url 'group-attention-create' group.pk %}"><i class="sg sg-attention" title="Bei neuen Beiträgen benachrichtigt werden"></i></a>
            {% elif can_delete_attention %}
                <a href="{% url 'group-attention-delete' attention.pk %}"><i class="sg sg-attention" title="Du erhältst Benachrichtungen für diese Gruppe"></i></a>
            {% endif %}
            {% if can_edit %}
                <a href="{% url 'group-update' group.pk %}"><i class="fa fa-pencil" title="Gruppenangaben ändern"></i></a>
            {% endif %}
        </div>
        <div class="group-info-slug">
            <dl class="def def-icons">
                <dt>
                    <i class="sg sg-link"></i>
                    <span class="sr-only">URL auf Stadtgestalten</span>
                </dt>
                <dd>
                    {{ site.domain }}/ {{ group.slug }}
                </dd>
            </dl>

        </div>
    </div>
</div>
